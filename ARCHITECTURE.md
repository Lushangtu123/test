# ğŸ—ï¸ WebCode Studio - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
2. [ç³»ç»Ÿè®¾è®¡](#ç³»ç»Ÿè®¾è®¡)
3. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
4. [æ•°æ®æµ](#æ•°æ®æµ)
5. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
6. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
7. [å®‰å…¨è€ƒè™‘](#å®‰å…¨è€ƒè™‘)
8. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   HTML5    â”‚  â”‚    CSS3    â”‚  â”‚  JavaScript  â”‚      â”‚
â”‚  â”‚  Structure â”‚  â”‚   Styles   â”‚  â”‚  ES6+ Logic  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Presentation Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Header    â”‚  â”‚    Editor    â”‚  â”‚   Preview    â”‚  â”‚
â”‚  â”‚  (Controls)  â”‚  â”‚   (CodeMirror)â”‚  â”‚   (iframe)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Console    â”‚  â”‚    Modal     â”‚  â”‚  StatusBar   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Business Logic Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Editor     â”‚  â”‚   Preview    â”‚  â”‚   Template   â”‚  â”‚
â”‚  â”‚   Manager    â”‚  â”‚   Engine     â”‚  â”‚   System     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Export     â”‚  â”‚    Share     â”‚  â”‚   Settings   â”‚  â”‚
â”‚  â”‚   Module     â”‚  â”‚   Module     â”‚  â”‚   Manager    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LocalStorage â”‚  â”‚    Blob      â”‚  â”‚   PostMessageâ”‚  â”‚
â”‚  â”‚  (Settings)  â”‚  â”‚   (Export)   â”‚  â”‚  (Console)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç³»ç»Ÿè®¾è®¡

### è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–**ï¼šåŠŸèƒ½ç‹¬ç«‹ï¼ŒèŒè´£æ¸…æ™°
2. **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
3. **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
4. **å®‰å…¨æ€§**ï¼šiframe æ²™ç®±éš”ç¦»
5. **å“åº”å¼**ï¼šé€‚é…å¤šç§è®¾å¤‡

### æŠ€æœ¯æ ˆé€‰æ‹©ç†ç”±

| æŠ€æœ¯ | é€‰æ‹©ç†ç”± |
|------|----------|
| **åŸç”Ÿ JavaScript** | æ— æ¡†æ¶ä¾èµ–ï¼ŒåŠ è½½å¿«é€Ÿï¼Œå­¦ä¹ æˆæœ¬ä½ |
| **CodeMirror** | æˆç†Ÿç¨³å®šï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç¤¾åŒºæ´»è·ƒ |
| **CSS Grid/Flexbox** | ç°ä»£å¸ƒå±€ï¼Œå“åº”å¼å‹å¥½ |
| **LocalStorage** | ç®€å•é«˜æ•ˆï¼Œæ— éœ€åç«¯ |
| **Blob URL** | æ€§èƒ½ä¼˜äº srcdocï¼Œå®‰å…¨æ€§å¥½ |

---

## æ ¸å¿ƒæ¨¡å—

### 1. ç¼–è¾‘å™¨ç®¡ç†æ¨¡å—

**èŒè´£**ï¼šç®¡ç†ä¸‰ä¸ªä»£ç ç¼–è¾‘å™¨ï¼ˆHTMLã€CSSã€JSï¼‰

```javascript
// æ¶æ„è®¾è®¡
EditorManager {
    - htmlEditor: CodeMirror
    - cssEditor: CodeMirror
    - jsEditor: CodeMirror
    
    + initializeEditors()
    + switchTab(tabName)
    + formatCode()
    + updateEditorStats()
    + changeTheme(theme)
    + updateFontSize(size)
}
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç¼–è¾‘å™¨åˆå§‹åŒ–é…ç½®
- æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘
- ä¸»é¢˜å’Œå­—ä½“ç®¡ç†
- ä»£ç ç»Ÿè®¡ï¼ˆè¡Œæ•°ã€å­—ç¬¦æ•°ï¼‰

**å…³é”®ä»£ç **ï¼š
```javascript
function initializeEditors() {
    const commonOptions = {
        theme: currentTheme,
        lineNumbers: true,
        autoCloseBrackets: true,
        // ...æ›´å¤šé…ç½®
    };
    
    htmlEditor = CodeMirror.fromTextArea(
        document.getElementById('htmlEditor'),
        { ...commonOptions, mode: 'htmlmixed' }
    );
    
    // ç›‘å¬å˜åŒ–
    htmlEditor.on('change', () => {
        debounceUpdate();
        updateEditorStats();
    });
}
```

### 2. é¢„è§ˆå¼•æ“æ¨¡å—

**èŒè´£**ï¼šå®æ—¶æ¸²æŸ“ç”¨æˆ·ä»£ç 

```javascript
// æ¶æ„è®¾è®¡
PreviewEngine {
    - previewElement: HTMLIFrameElement
    - updateTimeout: Timer
    
    + buildFullHTML(html, css, js)
    + updatePreview()
    + debounceUpdate()
    + setPreviewDevice(device)
}
```

**æ ¸å¿ƒæŠ€æœ¯**ï¼š

1. **HTML æ„å»º**
```javascript
function buildFullHTML(html, css, js) {
    // 1. æ³¨å…¥æ§åˆ¶å°æ•è·è„šæœ¬
    const consoleCapture = `/* æ•è· console è¾“å‡º */`;
    
    // 2. æ³¨å…¥ CSS
    const styleTag = `<style>${css}</style>`;
    
    // 3. æ³¨å…¥ JavaScript
    const scriptTag = `<script>${js}</script>`;
    
    // 4. ç»„åˆå®Œæ•´æ–‡æ¡£
    return fullHTML;
}
```

2. **Blob URL æŠ€æœ¯**
```javascript
function updatePreview() {
    const fullHTML = buildFullHTML(html, css, js);
    
    // ä½¿ç”¨ Blob åˆ›å»ºä¸´æ—¶ URL
    const blob = new Blob([fullHTML], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    // æ›´æ–° iframe
    preview.src = url;
    
    // æ¸…ç†æ—§ URL
    setTimeout(() => URL.revokeObjectURL(url), 1000);
}
```

3. **é˜²æŠ–ä¼˜åŒ–**
```javascript
function debounceUpdate() {
    clearTimeout(updateTimeout);
    updateTimeout = setTimeout(() => {
        updatePreview();
    }, 500); // 500ms å»¶è¿Ÿ
}
```

### 3. æ¨¡æ¿ç³»ç»Ÿæ¨¡å—

**èŒè´£**ï¼šæä¾›é¢„è®¾ä»£ç æ¨¡æ¿

```javascript
// æ¶æ„è®¾è®¡
TemplateSystem {
    - templates: Object
    
    + initializeTemplateMenu()
    + loadTemplate(key)
    + saveAsTemplate()
}
```

**æ•°æ®ç»“æ„**ï¼š
```javascript
const CodeTemplates = {
    templateKey: {
        name: 'æ¨¡æ¿åç§°',
        description: 'æ¨¡æ¿æè¿°',
        html: '/* HTML ä»£ç  */',
        css: '/* CSS ä»£ç  */',
        js: '/* JavaScript ä»£ç  */'
    }
};
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- ç‹¬ç«‹æ–‡ä»¶ï¼Œæ˜“äºç»´æŠ¤
- å¯¹è±¡ç»“æ„ï¼Œæ˜“äºæ‰©å±•
- åŠ¨æ€èœå•ç”Ÿæˆ

### 4. å¯¼å‡ºæ¨¡å—

**èŒè´£**ï¼šæ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º

```javascript
// æ¶æ„è®¾è®¡
ExportModule {
    + exportAsHTML()
    + exportAsZIP()
    + saveAsJSON()
    + handleExport(action)
}
```

**æŠ€æœ¯å®ç°**ï¼š

1. **å¯¼å‡º HTML**ï¼ˆå•æ–‡ä»¶ï¼‰
```javascript
function exportAsHTML() {
    const fullHTML = buildFullHTML(html, css, js);
    const blob = new Blob([fullHTML], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    
    // è§¦å‘ä¸‹è½½
    const a = document.createElement('a');
    a.href = url;
    a.download = `project-${Date.now()}.html`;
    a.click();
}
```

2. **å¯¼å‡º ZIP**ï¼ˆå¤šæ–‡ä»¶ï¼‰
```javascript
function exportAsZIP() {
    const zip = new JSZip();
    
    // æ·»åŠ æ–‡ä»¶
    zip.file('index.html', htmlEditor.getValue());
    zip.file('styles.css', cssEditor.getValue());
    zip.file('script.js', jsEditor.getValue());
    zip.file('README.md', generateREADME());
    
    // ç”Ÿæˆå¹¶ä¸‹è½½
    zip.generateAsync({ type: 'blob' })
       .then(content => saveAs(content, 'project.zip'));
}
```

3. **ä¿å­˜ JSON**ï¼ˆé…ç½®æ–‡ä»¶ï¼‰
```javascript
function saveAsJSON() {
    const code = {
        html: htmlEditor.getValue(),
        css: cssEditor.getValue(),
        js: jsEditor.getValue(),
        timestamp: new Date().toISOString(),
        version: '2.0'
    };
    
    const blob = new Blob([JSON.stringify(code, null, 2)], 
                         { type: 'application/json' });
    // ...ä¸‹è½½é€»è¾‘
}
```

### 5. åˆ†äº«æ¨¡å—

**èŒè´£**ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥å’ŒäºŒç»´ç 

```javascript
// æ¶æ„è®¾è®¡
ShareModule {
    + showShareModal()
    + generateShareLink()
    + generateQRCode()
    + copyShareLink()
    + loadSharedCode()
}
```

**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·ç‚¹å‡»åˆ†äº«
    â†“
ä¿å­˜ä»£ç åˆ° LocalStorage
    â†“
ç”Ÿæˆå”¯ä¸€ ID (share_timestamp)
    â†“
æ„å»ºåˆ†äº« URL (origin + ?share=ID)
    â†“
æ˜¾ç¤ºæ¨¡æ€æ¡† + äºŒç»´ç 
    â†“
ç”¨æˆ·å¤åˆ¶é“¾æ¥
    â†“
æ¥æ”¶è€…æ‰“å¼€é“¾æ¥
    â†“
ä» URL å‚æ•°è·å– ID
    â†“
ä» LocalStorage åŠ è½½ä»£ç 
    â†“
è‡ªåŠ¨å¡«å……ç¼–è¾‘å™¨
```

**æ ¸å¿ƒä»£ç **ï¼š
```javascript
function showShareModal() {
    const code = {
        html: htmlEditor.getValue(),
        css: cssEditor.getValue(),
        js: jsEditor.getValue()
    };
    
    // ç”Ÿæˆå”¯ä¸€ ID
    const shareId = 'share_' + Date.now();
    
    // ä¿å­˜åˆ° LocalStorage
    localStorage.setItem(shareId, JSON.stringify(code));
    
    // æ„å»ºåˆ†äº«é“¾æ¥
    const shareUrl = window.location.origin + 
                    window.location.pathname + 
                    '?share=' + shareId;
    
    // ç”ŸæˆäºŒç»´ç 
    new QRCode(qrcodeContainer, {
        text: shareUrl,
        width: 200,
        height: 200
    });
}
```

### 6. æ§åˆ¶å°æ¨¡å—

**èŒè´£**ï¼šæ•è·å¹¶æ˜¾ç¤º console è¾“å‡º

```javascript
// æ¶æ„è®¾è®¡
ConsoleModule {
    - messages: Array
    
    + addConsoleMessage(level, message)
    + clearConsole()
    + toggleConsole()
    + captureConsoleInIframe()
}
```

**è·¨åŸŸé€šä¿¡**ï¼š

1. **iframe å†…æ³¨å…¥è„šæœ¬**
```javascript
const consoleCapture = `
    <script>
        // ä¿å­˜åŸå§‹æ–¹æ³•
        const originalLog = console.log;
        
        // é‡å†™ console.log
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
            window.parent.postMessage({
                type: 'console',
                level: 'log',
                message: args.join(' ')
            }, '*');
        };
        
        // æ•è·é”™è¯¯
        window.addEventListener('error', function(e) {
            window.parent.postMessage({
                type: 'console',
                level: 'error',
                message: e.message
            }, '*');
        });
    </script>
`;
```

2. **ä¸»çª—å£æ¥æ”¶æ¶ˆæ¯**
```javascript
window.addEventListener('message', function(e) {
    if (e.data.type === 'console') {
        addConsoleMessage(e.data.level, e.data.message);
    }
});
```

### 7. è®¾ç½®ç®¡ç†æ¨¡å—

**èŒè´£**ï¼šç®¡ç†ç”¨æˆ·åå¥½è®¾ç½®

```javascript
// æ¶æ„è®¾è®¡
SettingsManager {
    - settings: Object
    
    + saveSettings()
    + loadSettings()
    + applySettings()
    + resetSettings()
}
```

**æŒä¹…åŒ–ç­–ç•¥**ï¼š
```javascript
// ä¿å­˜è®¾ç½®
function saveSettings() {
    const settings = {
        theme: currentTheme,
        fontSize: currentFontSize,
        autoUpdate: isAutoUpdate,
        lineWrap: lineWrap
    };
    
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
}

// åŠ è½½è®¾ç½®
function loadSettings() {
    const saved = localStorage.getItem(SETTINGS_KEY);
    if (saved) {
        const settings = JSON.parse(saved);
        applySettings(settings);
    }
}
```

---

## æ•°æ®æµ

### 1. ç”¨æˆ·ç¼–è¾‘æµç¨‹

```
ç”¨æˆ·è¾“å…¥ä»£ç 
    â†“
CodeMirror è§¦å‘ change äº‹ä»¶
    â†“
debounceUpdate() é˜²æŠ–å¤„ç†
    â†“
500ms åè§¦å‘ updatePreview()
    â†“
buildFullHTML() æ„å»ºå®Œæ•´æ–‡æ¡£
    â†“
åˆ›å»º Blob URL
    â†“
æ›´æ–° iframe.src
    â†“
iframe åŠ è½½å¹¶æ¸²æŸ“
    â†“
æ§åˆ¶å°æ¶ˆæ¯é€šè¿‡ postMessage è¿”å›
    â†“
æ˜¾ç¤ºåœ¨æ§åˆ¶å°é¢æ¿
```

### 2. æ¨¡æ¿åŠ è½½æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ¨¡æ¿æŒ‰é’®
    â†“
æ˜¾ç¤ºæ¨¡æ¿èœå•
    â†“
ç”¨æˆ·é€‰æ‹©æ¨¡æ¿
    â†“
ç¡®è®¤å¯¹è¯æ¡†
    â†“
loadTemplate(key)
    â†“
ä» CodeTemplates è·å–æ¨¡æ¿æ•°æ®
    â†“
htmlEditor.setValue(template.html)
cssEditor.setValue(template.css)
jsEditor.setValue(template.js)
    â†“
è§¦å‘ change äº‹ä»¶
    â†“
è‡ªåŠ¨æ›´æ–°é¢„è§ˆ
```

### 3. å¯¼å‡ºæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»å¯¼å‡ºæŒ‰é’®
    â†“
æ˜¾ç¤ºå¯¼å‡ºèœå•
    â†“
ç”¨æˆ·é€‰æ‹©å¯¼å‡ºæ ¼å¼
    â†“
æ”¶é›†ä»£ç æ•°æ®
    â†“
æ ¹æ®æ ¼å¼å¤„ç†ï¼š
    â”œâ”€ HTML: buildFullHTML() â†’ Blob â†’ ä¸‹è½½
    â”œâ”€ ZIP: JSZip â†’ æ·»åŠ æ–‡ä»¶ â†’ ç”Ÿæˆ â†’ ä¸‹è½½
    â””â”€ JSON: JSON.stringify() â†’ Blob â†’ ä¸‹è½½
    â†“
æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
```

### 4. åˆ†äº«æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»åˆ†äº«
    â†“
æ”¶é›†å½“å‰ä»£ç 
    â†“
ç”Ÿæˆå”¯ä¸€ ID
    â†“
ä¿å­˜åˆ° LocalStorage
    â†“
æ„å»ºåˆ†äº« URL
    â†“
ç”ŸæˆäºŒç»´ç 
    â†“
æ˜¾ç¤ºæ¨¡æ€æ¡†
    â†“
ç”¨æˆ·å¤åˆ¶é“¾æ¥
    â†“
---æ¥æ”¶è€…æµç¨‹---
    â†“
æ‰“å¼€é“¾æ¥ï¼ˆå¸¦ share å‚æ•°ï¼‰
    â†“
ä» URL è·å– share ID
    â†“
ä» LocalStorage è¯»å–ä»£ç 
    â†“
è‡ªåŠ¨å¡«å……ç¼–è¾‘å™¨
    â†“
æ›´æ–°é¢„è§ˆ
```

---

## æŠ€æœ¯é€‰å‹

### ä¸ºä»€ä¹ˆé€‰æ‹© CodeMirrorï¼Ÿ

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **åŠŸèƒ½å¼ºå¤§** | æ”¯æŒè¯­æ³•é«˜äº®ã€ä»£ç æŠ˜å ã€è‡ªåŠ¨è¡¥å…¨ |
| **å¯å®šåˆ¶** | ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œä¸»é¢˜ |
| **æ€§èƒ½å¥½** | è™šæ‹Ÿæ¸²æŸ“ï¼Œæ”¯æŒå¤§æ–‡ä»¶ |
| **æˆç†Ÿç¨³å®š** | å¹¿æ³›ä½¿ç”¨ï¼Œbug å°‘ |
| **ç¤¾åŒºæ´»è·ƒ** | æ’ä»¶ä¸°å¯Œï¼Œæ–‡æ¡£å®Œå–„ |

**å¯¹æ¯”å…¶ä»–ç¼–è¾‘å™¨**ï¼š

- **Monaco Editor**ï¼šåŠŸèƒ½æ›´å¼ºä½†ä½“ç§¯å¤§ï¼ˆVS Code ç¼–è¾‘å™¨ï¼‰
- **Ace Editor**ï¼šåŠŸèƒ½ç±»ä¼¼ä½† API ä¸å¦‚ CodeMirror å‹å¥½
- **åŸç”Ÿ textarea**ï¼šåŠŸèƒ½å¤ªç®€å•ï¼Œç”¨æˆ·ä½“éªŒå·®

### ä¸ºä»€ä¹ˆä½¿ç”¨ Blob URLï¼Ÿ

**ä¼˜åŠ¿**ï¼š
1. **æ€§èƒ½å¥½**ï¼šæ¯” `srcdoc` æ›´å¿«
2. **å®‰å…¨**ï¼šè‡ªåŠ¨æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
3. **çµæ´»**ï¼šæ”¯æŒä»»æ„ HTML å†…å®¹
4. **å…¼å®¹æ€§**ï¼šç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ

**å¯¹æ¯” srcdoc**ï¼š
```javascript
// srcdoc æ–¹å¼ï¼ˆä¸æ¨èï¼‰
iframe.srcdoc = fullHTML; // æœ‰é•¿åº¦é™åˆ¶

// Blob URL æ–¹å¼ï¼ˆæ¨èï¼‰
const blob = new Blob([fullHTML], { type: 'text/html' });
const url = URL.createObjectURL(blob);
iframe.src = url;
```

### ä¸ºä»€ä¹ˆä½¿ç”¨ LocalStorageï¼Ÿ

**ä¼˜åŠ¿**ï¼š
- ç®€å•æ˜“ç”¨ï¼Œæ— éœ€åç«¯
- æŒä¹…åŒ–å­˜å‚¨ï¼Œåˆ·æ–°ä¸ä¸¢å¤±
- åŒæ­¥ APIï¼Œä½¿ç”¨æ–¹ä¾¿
- å®¹é‡å¤Ÿç”¨ï¼ˆ5-10MBï¼‰

**å±€é™æ€§**ï¼š
- åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²
- å®¹é‡æœ‰é™ï¼ˆå¤§é¡¹ç›®ä¸é€‚åˆï¼‰
- åŒæºç­–ç•¥é™åˆ¶

**æœªæ¥æ”¹è¿›**ï¼šå¯å‡çº§ä¸º IndexedDB æˆ–äº‘ç«¯å­˜å‚¨

---

## æ€§èƒ½ä¼˜åŒ–

### 1. é˜²æŠ–ä¼˜åŒ–

**é—®é¢˜**ï¼šç”¨æˆ·æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦å°±æ›´æ–°é¢„è§ˆï¼Œå¯¼è‡´é¢‘ç¹æ¸²æŸ“

**è§£å†³**ï¼š
```javascript
let updateTimeout;

function debounceUpdate() {
    clearTimeout(updateTimeout);
    updateTimeout = setTimeout(() => {
        updatePreview();
    }, 500); // 500ms å»¶è¿Ÿ
}
```

**æ•ˆæœ**ï¼š
- å‡å°‘ 80% çš„é¢„è§ˆæ›´æ–°æ¬¡æ•°
- æµç•…çš„ç¼–è¾‘ä½“éªŒ
- é™ä½ CPU ä½¿ç”¨ç‡

### 2. ä»£ç åˆ†å‰²

**é—®é¢˜**ï¼šæ‰€æœ‰ä»£ç åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŠ è½½æ…¢

**è§£å†³**ï¼š
```
script.js        - æ ¸å¿ƒé€»è¾‘ï¼ˆ25KBï¼‰
templates.js     - æ¨¡æ¿åº“ï¼ˆ15KBï¼‰
styles.css       - æ ·å¼ï¼ˆ20KBï¼‰
```

**æ•ˆæœ**ï¼š
- æ¨¡æ¿åº“æŒ‰éœ€åŠ è½½
- æ›´å¿«çš„é¦–å±åŠ è½½
- æ›´å¥½çš„ä»£ç ç»„ç»‡

### 3. äº‹ä»¶å§”æ‰˜

**é—®é¢˜**ï¼šä¸ºæ¯ä¸ªæŒ‰é’®ç»‘å®šäº‹ä»¶ç›‘å¬å™¨

**è§£å†³**ï¼š
```javascript
// ä¸å¥½çš„åšæ³•
buttons.forEach(btn => {
    btn.addEventListener('click', handler);
});

// å¥½çš„åšæ³•
parent.addEventListener('click', (e) => {
    if (e.target.matches('.btn')) {
        handler(e);
    }
});
```

### 4. æ‡’åŠ è½½

**ç¼–è¾‘å™¨åˆ·æ–°ä¼˜åŒ–**ï¼š
```javascript
function switchTab(tabName) {
    // å»¶è¿Ÿåˆ·æ–°ï¼Œé¿å…å¡é¡¿
    setTimeout(() => {
        editor.refresh();
    }, 100);
}
```

### 5. èµ„æºæ¸…ç†

**Blob URL æ¸…ç†**ï¼š
```javascript
function updatePreview() {
    const url = URL.createObjectURL(blob);
    preview.src = url;
    
    // 1ç§’åæ¸…ç†
    setTimeout(() => {
        URL.revokeObjectURL(url);
    }, 1000);
}
```

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… |
|------|------|------|
| **é¦–æ¬¡åŠ è½½** | < 2s | < 1s |
| **ç¼–è¾‘å“åº”** | < 100ms | < 50ms |
| **é¢„è§ˆæ›´æ–°** | < 500ms | < 300ms |
| **å¯¼å‡ºé€Ÿåº¦** | < 2s | < 1s |
| **å†…å­˜å ç”¨** | < 50MB | < 30MB |

---

## å®‰å…¨è€ƒè™‘

### 1. XSS é˜²æŠ¤

**iframe æ²™ç®±**ï¼š
```html
<iframe 
    id="preview" 
    sandbox="allow-scripts allow-same-origin">
</iframe>
```

**æ²™ç®±é™åˆ¶**ï¼š
- é˜»æ­¢è¡¨å•æäº¤
- é˜»æ­¢å¼¹çª—
- é˜»æ­¢æ’ä»¶
- å…è®¸è„šæœ¬ï¼ˆç”¨æˆ·ä»£ç ï¼‰
- å…è®¸åŒæºï¼ˆæ§åˆ¶å°é€šä¿¡ï¼‰

### 2. CSPï¼ˆContent Security Policyï¼‰

æœªæ¥å¯æ·»åŠ ï¼š
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'">
```

### 3. æ•°æ®éªŒè¯

**åŠ è½½å¤–éƒ¨æ–‡ä»¶æ—¶éªŒè¯**ï¼š
```javascript
function handleFileLoad(event) {
    try {
        const code = JSON.parse(e.target.result);
        
        // éªŒè¯æ•°æ®ç»“æ„
        if (typeof code.html !== 'string' ||
            typeof code.css !== 'string' ||
            typeof code.js !== 'string') {
            throw new Error('æ— æ•ˆçš„æ•°æ®æ ¼å¼');
        }
        
        // å®‰å…¨åŠ è½½
        loadCode(code);
    } catch (error) {
        showNotification('æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
    }
}
```

---

## æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶ç³»ç»Ÿï¼ˆè§„åˆ’ï¼‰

```javascript
// æ’ä»¶æ¥å£
const PluginAPI = {
    registerEditor(name, editor) {},
    registerTemplate(key, template) {},
    registerExporter(format, handler) {},
    on(event, handler) {},
    emit(event, data) {}
};

// æ’ä»¶ç¤ºä¾‹
const TypeScriptPlugin = {
    name: 'TypeScript Support',
    init(api) {
        api.registerEditor('typescript', tsEditor);
        api.on('compile', (code) => {
            return transpile(code);
        });
    }
};
```

### 2. ä¸»é¢˜ç³»ç»Ÿæ‰©å±•

```javascript
// ä¸»é¢˜é…ç½®
const themes = {
    monokai: { /* é…ç½® */ },
    dracula: { /* é…ç½® */ },
    custom: { /* ç”¨æˆ·è‡ªå®šä¹‰ */ }
};

// åŠ¨æ€åŠ è½½ä¸»é¢˜
function loadTheme(name) {
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = `themes/${name}.css`;
    document.head.appendChild(link);
}
```

### 3. å¤šè¯­è¨€æ”¯æŒ

```javascript
// i18n é…ç½®
const i18n = {
    'zh-CN': {
        'run': 'è¿è¡Œ',
        'export': 'å¯¼å‡º',
        // ...
    },
    'en-US': {
        'run': 'Run',
        'export': 'Export',
        // ...
    }
};

// åˆ‡æ¢è¯­è¨€
function setLanguage(lang) {
    currentLanguage = lang;
    updateUI();
}
```

### 4. API è®¾è®¡

```javascript
// å¯¹å¤–æš´éœ²çš„ API
window.WebCodeStudio = {
    version: '2.0',
    
    // è·å–ä»£ç 
    getCode() {
        return {
            html: htmlEditor.getValue(),
            css: cssEditor.getValue(),
            js: jsEditor.getValue()
        };
    },
    
    // è®¾ç½®ä»£ç 
    setCode(code) {
        if (code.html) htmlEditor.setValue(code.html);
        if (code.css) cssEditor.setValue(code.css);
        if (code.js) jsEditor.setValue(code.js);
        updatePreview();
    },
    
    // æ›´æ–°é¢„è§ˆ
    updatePreview() {
        updatePreview();
    },
    
    // åŠ è½½æ¨¡æ¿
    loadTemplate(key) {
        loadTemplate(key);
    },
    
    // å¯¼å‡º
    export(format) {
        handleExport(format);
    }
};
```

---

## æ€»ç»“

WebCode Studio é‡‡ç”¨æ¨¡å—åŒ–ã€åˆ†å±‚çš„æ¶æ„è®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

âœ… **æ¸…æ™°çš„æ¶æ„**ï¼šåˆ†å±‚æ˜ç¡®ï¼ŒèŒè´£æ¸…æ™°
âœ… **é«˜æ€§èƒ½**ï¼šé˜²æŠ–ã€æ‡’åŠ è½½ã€äº‹ä»¶å§”æ‰˜ç­‰ä¼˜åŒ–
âœ… **å®‰å…¨æ€§**ï¼šiframe æ²™ç®±éš”ç¦»
âœ… **å¯æ‰©å±•**ï¼šæ’ä»¶ç³»ç»Ÿã€API è®¾è®¡
âœ… **æ˜“ç»´æŠ¤**ï¼šä»£ç æ¨¡å—åŒ–ï¼Œæ³¨é‡Šå®Œå–„

è¿™ä¸ªæ¶æ„æ—¢é€‚åˆå½“å‰éœ€æ±‚ï¼Œä¹Ÿä¸ºæœªæ¥æ‰©å±•é¢„ç•™äº†ç©ºé—´ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0
**æœ€åæ›´æ–°**ï¼š2025-01-07

